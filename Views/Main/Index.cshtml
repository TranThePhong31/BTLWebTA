@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- ====================== -->
<!-- PHẦN TRÌNH CHIẾU (TÙY CHỌN) -->
<!-- ====================== -->
<!-- ====================== -->
<!-- NỘI DUNG CHÍNH -->
<!-- ====================== -->
<section class="content-section">
    <div class="content">

        <!-- 🟢 TAB 1: TỪ VỰNG -->
        <div id="vocab" class="tab active">
            <div class="card">
                <h2>Flashcards của tôi</h2>

                <!-- Flashcard Management -->
                <div class="flashcards-management">
                    <button class="action" onclick="loadFlashcards(1)">🔄 Tải Flashcards</button>
                    <button class="action" onclick="startPractice()">📚 Bắt đầu luyện tập</button>

                    <!-- Page Size Selector -->
                    <div class="page-size-selector" style="display: inline-block; margin-left: 15px;">
                        <label for="pageSize">Hiển thị:</label>
                        <select id="pageSize" onchange="changePageSize(this.value)" style="margin-left: 5px; padding: 5px;">
                            <option value="10">10 thẻ</option>
                            <option value="20">20 thẻ</option>
                            <option value="50">50 thẻ</option>
                            <option value="100">100 thẻ</option>
                        </select>
                    </div>
                </div>

                <!-- Flashcards Grid -->
                <div id="flashcardsGrid" class="flashcards-grid" style="display: none; margin-top: 20px;">
                    <!-- Flashcards will be loaded here -->
                </div>

                <!-- Pagination Container will be inserted here by JavaScript -->
                <!-- Practice Section -->
                <div id="practiceSection" style="display: none; margin-top: 20px;">
                    <div class="practice-container">
                        <!-- Progress Bar -->
                        <div class="progress-section">
                            <div class="progress">
                                <div id="practiceProgress" class="progress-bar" style="width: 0%"></div>
                            </div>
                            <div id="progressText" class="progress-text">0/0</div>
                        </div>

                        <!-- Flashcard Review -->
                        <div id="flashcardReview" class="flashcard-review" style="display: none;">
                            <div class="flashcard">
                                <h2 id="practiceWord" class="word"></h2>
                                <p id="practiceMeaning" class="meaning" style="display: none;"></p>
                                <img id="practiceImage" class="word-image" style="display: none; max-width: 200px; margin: 10px auto;" />
                            </div>

                            <div class="difficulty-buttons">
                                <h4>Đánh giá độ khó:</h4>
                                <div class="button-group">
                                    <button class="action btn-success" onclick="submitDifficulty('Easy')">Dễ</button>
                                    <button class="action btn-warning" onclick="submitDifficulty('Medium')">Trung bình</button>
                                    <button class="action btn-danger" onclick="submitDifficulty('Hard')">Khó</button>
                                </div>
                            </div>
                        </div>

                        <!-- Exercise Section -->
                        <div id="exerciseSection" class="exercise-section" style="display: none;">
                            <!-- Multiple Choice Exercise -->
                            <div id="multipleChoiceExercise" style="display: none;">
                                <h4>Chọn nghĩa đúng của từ: "<strong id="mcWord"></strong>"</h4>
                                <div id="choicesContainer" class="choices-container"></div>
                                <button class="action" onclick="submitExerciseAnswer()" style="margin-top: 10px;">Kiểm tra</button>
                            </div>

                            <!-- Fill in Blank Exercise -->
                            <div id="fillBlankExercise" style="display: none;">
                                <h4>Điền từ vào chỗ trống:</h4>
                                <p id="fillMeaning" class="meaning"></p>
                                <p id="fillExample" class="example-sentence"></p>
                                <input type="text" id="fillAnswer" placeholder="Điền từ vào chỗ trống..."
                                       class="form-control" style="margin: 10px 0;" />
                                <button class="action" onclick="submitFillAnswer()">Kiểm tra</button>
                            </div>
                        </div>

                        <!-- Add this after the exercise sections but before practiceComplete -->
                        <div id="exerciseFeedback" style="display: none; margin-top: 15px; padding: 10px; border-radius: 5px;">
                            <div id="feedbackMessage"></div>
                            <button id="nextExerciseBtn" class="action" onclick="nextAfterFeedback()" style="margin-top: 10px; display: none;">
                                Tiếp tục
                            </button>
                            <button id="retryExerciseBtn" class="action" onclick="retryExercise()" style="margin-top: 10px; display: none;">
                                Thử lại
                            </button>
                        </div>

                        <!-- Practice Complete -->
                        <div id="practiceComplete" style="display: none; text-align: center;">
                            <h3>🎉 Hoàn thành luyện tập!</h3>
                            <div id="practiceSummary"></div>
                            <button class="action" onclick="resetPractice()">Luyện tập lại</button>
                        </div>

                        <!-- Add retry section at the end -->
                        <div id="retrySection" style="display: none; margin-top: 20px;">
                            <h3>🔁 Ôn tập lại các từ chưa đúng</h3>
                            <div id="retryWordsList"></div>
                            <button class="action" onclick="startRetrySession()">Bắt đầu ôn tập</button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyFlashcards" class="empty-state" style="display: none; text-align: center; margin-top: 20px;">
                    <p>Chưa có flashcard nào. Hãy thêm từ mới để bắt đầu học!</p>
                </div>

            </div>
        </div>

        <!-- TAB NGHE & NÓI -->
        <div id="listening" class="tab">
            <div class="card listening-card">
                <h2 class="title">🎧 Bài nghe & Nói</h2>

                <!-- Hiển thị từ cần phát âm -->
                <div class="word-section">
                    <h3>🔤 Hãy phát âm từ sau:</h3>
                    <div id="randomWord" class="word-box">@ViewBag.Word</div>
                    <input type="hidden" name="referenceText" value="@ViewBag.Word" />

                    <button class="action-btn" id="newWordBtn" data-url="/Speech/Index">🎲 Lấy từ mới</button>
                </div>

                <!-- Ghi âm -->
                <div class="record-section">
                    <button class="action-btn start" id="startRecordingBtn">🎤 Bắt đầu ghi âm</button>
                    <button class="action-btn stop" id="stopRecordingBtn" disabled>⏹️ Dừng ghi âm</button>
                </div>

                <!-- Nghe lại bản ghi -->
                <audio id="audioPlayer" controls style="display:none; margin-top:15px; width:100%;"></audio>

                <!-- Hiển thị kết quả -->
                <div id="speechResult" class="result-box"></div>
                <div id="speechStatus" class="status-text"></div>
            </div>
        </div>

        <style>
            /* Khung chính */
            .listening-card {
                max-width: 500px;
                margin: 30px auto;
                padding: 25px;
                background: #ffffff;
                border-radius: 16px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                text-align: center;
                font-family: "Segoe UI", sans-serif;
            }

            .title {
                font-size: 24px;
                color: #333;
                margin-bottom: 15px;
            }

            /* Khu vực hiển thị từ */
            .word-section {
                margin-top: 20px;
                display: flex;
                flex-direction: column; /* Xếp theo chiều dọc */
                align-items: center; /* Căn giữa ngang */
                justify-content: center; /* Căn giữa dọc (nếu có chiều cao cố định) */
                gap: 15px; /* Khoảng cách giữa các phần tử bên trong */
            }

            .word-box {
                font-size: 48px;
                font-weight: 700;
                color: #1d4ed8;
                background: linear-gradient(135deg, #dbeafe, #eff6ff);
                padding: 25px 40px;
                border-radius: 20px;
                box-shadow: 0 8px 20px rgba(29, 78, 216, 0.2);
                text-align: center;
                transition: all 0.25s ease;
            }

                .word-box:hover {
                    transform: scale(1.08);
                    box-shadow: 0 10px 25px rgba(29, 78, 216, 0.3);
                }


            /* Nút hành động */
            .action-btn {
                margin: 6px;
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                font-size: 15px;
                cursor: pointer;
                background-color: #2563eb;
                color: white;
                transition: background 0.3s, transform 0.2s;
            }

                .action-btn:hover {
                    background-color: #1e40af;
                    transform: translateY(-2px);
                }

                .action-btn:disabled {
                    background-color: #9ca3af;
                    cursor: not-allowed;
                }

            .start {
                background-color: #10b981;
            }

                .start:hover {
                    background-color: #059669;
                }

            .stop {
                background-color: #ef4444;
            }

                .stop:hover {
                    background-color: #dc2626;
                }

            /* Kết quả */
            .result-box {
                margin-top: 15px;
                font-size: 16px;
                font-weight: 500;
                color: #111827;
                background: #f9fafb;
                border-radius: 10px;
                padding: 10px;
                display: block;
            }

            .status-text {
                margin-top: 8px;
                color: gray;
                font-size: 14px;
            }
        </style>

        <!-- 🔵 TAB 3: VIẾT -->
        <div id="writing" class="tab">
            @* <div class="card">
                <h2>Bài viết</h2>
                <textarea id="writingText" rows="5" style="width:100%" placeholder="Nhập đoạn văn cần kiểm tra..."></textarea>
                <button class="action" onclick="checkGrammar()">✅ Kiểm tra lỗi ngữ pháp</button>
            </div> *@

            <!-- ---------- PHẦN OCR / UPLOAD ẢNH ---------- -->
            <div class="card" style="margin-top:16px;">
                <h2>Writing</h2>

                <!-- Nếu bạn dùng ASP.NET MVC với antiforgery, giữ dòng @Html.AntiForgeryToken() -->
                @* Nếu không dùng Razor, xóa dòng dưới *@
                @Html.AntiForgeryToken()

                <div style="display:flex;gap:12px;align-items:center;">
                    <input type="file" id="ocrFile" accept="image/*" />
                    <button id="btnOcr" class="action">🔍 Nhận diện</button>
                    <span id="ocrStatus" style="margin-left:8px;color:#666"></span>
                </div>

                <div id="previewContainer" style="margin-top:10px;">
                    <img id="previewImage" src="" alt="preview" style="max-width:100%; display:none; border:1px solid #ddd; padding:6px; border-radius:4px;" />
                </div>

                <h3 style="margin-top:12px">Kết quả</h3>
                <pre id="ocrResult" style="white-space:pre-wrap; background:#fafafa; padding:12px; border-radius:6px; min-height:60px;"></pre>
            </div>
        </div>

        @* <!-- 🟣 TAB 4: ĐỌC HIỂU -->
        <div id="reading" class="tab">
            <div class="card">
                <h2>Bài đọc</h2>
                <textarea id="readingText" rows="5" style="width:100%" placeholder="Nhập đoạn văn để sinh câu hỏi..."></textarea>
                <button class="action" onclick="generateQuestions()">❓ Tạo câu hỏi trắc nghiệm</button>
            </div>
        </div> *@

        <!-- 🟠 TAB 5: THI THỬ -->
        <div id="exam" class="tab">
            <div class="card">
                <h2>Bài thi</h2>

                <div id="quizContainer">
                    <div id="quizHeader" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <div><strong>Câu <span id="questionNumber">0</span> / <span id="totalQuestions">10</span></strong></div>
                        <div id="quizTimer" style="color:#666; font-size:0.9em"></div>
                    </div>

                    <p id="examQuestion" style="font-weight:600; min-height:48px;">Nhấn "Bắt đầu" để bắt đầu bài thi.</p>

                    <div id="answerButtons" style="display:flex;flex-direction:column;gap:8px; margin-top:8px;">
                        <button class="action answer-btn" data-choice="A" onclick="selectAnswer('A')">A</button>
                        <button class="action answer-btn" data-choice="B" onclick="selectAnswer('B')">B</button>
                        <button class="action answer-btn" data-choice="C" onclick="selectAnswer('C')">C</button>
                        <button class="action answer-btn" data-choice="D" onclick="selectAnswer('D')">D</button>
                    </div>

                    <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                        <button id="startQuizBtn" class="action" onclick="startQuiz()">Bắt đầu</button>
                        <button id="nextBtn" class="action" onclick="nextQuestion()" style="display:none">Tiếp</button>
                        <div id="progressInfo" style="margin-left:12px;color:#666"></div>
                    </div>

                    <div id="quizResult" style="display:none; margin-top:14px;">
                        <h3>Kết quả</h3>
                        <p id="resultText"></p>
                        <button class="action" onclick="startQuiz()">Làm lại</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- 🧠 TAB 6: CHATBOT -->
        <!-- 🧠 TAB 6: CHATBOT -->
        <div id="chatbot" class="tab">
            <div class="card">
                <div class="chatbot-container">
                    <!-- Chat Sidebar -->
                    <div class="chat-sidebar">
                        <div class="sidebar-header">
                            <h3 class="sidebar-title">💬 Cuộc trò chuyện</h3>
                        </div>

                        <button class="new-chat-btn" onclick="createNewChat()">
                            ➕ Trò chuyện mới
                        </button>

                        <!-- Chat List -->
                        <div id="chatList" class="chat-list">
                            <div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px 0;">
                                Đang tải...
                            </div>
                        </div>

                        <!-- Chat Actions -->
                        <div class="chat-actions">
                            <button onclick="exportAllChats()">📥 Xuất tất cả</button>
                            <button onclick="deleteAllChats()" style="background: rgba(220,53,69,0.2); color: #ff6b6b; border-color: #ff6b6b;">
                                🗑️ Xóa tất cả
                            </button>
                        </div>
                    </div>

                    <!-- Main Chat Area -->
                    <div class="chat-main">
                        <!-- Header -->
                        <div class="chat-header">
                            <h2 id="currentChatTitle" class="chat-title">English Assistant 🤖</h2>
                            <div class="chat-controls">
                                <button onclick="renameCurrentChat()">✏️ Đổi tên</button>
                                <button onclick="exportCurrentChat()">📥 Xuất</button>
                                <button class="btn-danger" onclick="deleteCurrentChat()">🗑️ Xóa</button>
                            </div>
                        </div>

                        <!-- User Info Card -->
                        <div class="user-info-card">
                            <h4>👤 Thông tin của bạn</h4>
                            <div class="user-info-form">
                                <input type="text" id="username" placeholder="Nhập tên của bạn" />
                                <button onclick="updateUserInfo()">Cập nhật</button>
                            </div>
                            <input type="hidden" id="gender" value="Other" />
                        </div>

                        <!-- Chat Messages -->
                        <div id="chatMessages" class="chat-messages">
                            <div class="empty-chat">
                                <div>💬</div>
                                <h4>Chưa có cuộc trò chuyện</h4>
                                <p>Hãy gửi tin nhắn để bắt đầu!</p>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-form">
                            <input 
                                type="text" 
                                id="chatInput" 
                                placeholder="Hỏi tôi bất cứ điều gì về tiếng Anh..." 
                            />
                            <button onclick="sendChatMessage()">📤</button>
                        </div>

                        <!-- Chat Info & Suggestions -->
                        <div class="chat-info-row" style="margin-bottom: 10px;">
                            <span id="messageCount" class="message-count">💬 0 tin nhắn</span>
                            <span id="chatInfo" style="color: #666; font-size: 12px;"></span>
                        </div>

                        <!-- Suggestions -->
                        <div class="chat-suggestions">
                            <h5>💡 Thử hỏi:</h5>
                            <div class="suggestion-chips">
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Tôi có thể làm gì để cải thiện khả năng phát âm?')">
                                    Bí kíp phát âm
                                </button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Khác biệt giữa make và do là gì?')">
                                    Hỗ trợ ngữ pháp
                                </button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Bạn có thể cho tôi vài ví dụ để luyện tập giao tiếp không?')">
                                    Giao tiếp
                                </button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Giải thích cho tôi về thì hiện tại đơn')">
                                    Giải thích thì
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 💬 TAB 7: CHAT REALTIME -->
     
        <div id="realtime-chat" class="tab">

            <div class="card realtime-chat-card">

                <!-- Header -->
                <div class="chat-header-wrapper">
                    <h2>💬 Chat Realtime</h2>
                    <p class="subtitle">Trò chuyện realtime với cộng đồng học viên</p>
                </div>

                <!-- Main Container -->
                <div class="realtime-chat-container">

                    <!-- Sidebar -->
                    <aside class="chat-users-sidebar">

                        <div class="sidebar-header">
                            <h3 class="sidebar-title">👥 Người dùng</h3>
                        </div>

                        <!-- Search -->
                        <div class="search-box-wrapper">
                            <input type="text"
                                   id="userSearchInput"
                                   placeholder="🔍 Tìm người..."
                                   class="search-input" />
                        </div>

                        <!-- Users List -->
                        <div id="realtimeChatUsersList" class="users-list">
                            <div class="loading-state">
                                <p>⏳ Đang tải danh sách...</p>
                            </div>
                        </div>

                    </aside>

                    <!-- Chat Main Area -->
                    <div class="chat-main-area">

                        <!-- Selected User Header -->
                        <div class="chat-header-area">
                            <div class="chat-user-info">

                                <img id="selectedUserAvatar"
                                     src="https://via.placeholder.com/44"
                                     alt="Avatar"
                                     class="user-avatar" />

                                <div class="user-details">
                                    <h4 id="selectedUserName">Chọn một người để chat</h4>
                                    <small id="selectedUserStatus" class="user-status-text">Offline</small>
                                </div>
                            </div>

                            <div id="onlineIndicator" class="online-indicator offline"></div>
                        </div>

                        <!-- Messages -->
                        <div id="realtimeChatMessages" class="messages-area">
                            <div class="empty-messages">
                                <div class="empty-icon">👋</div>
                                <p>Chọn một người để bắt đầu trò chuyện</p>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-wrapper">
                            <form id="realtimeChatForm"
                                  onsubmit="sendRealtimeMessage(event)"
                                  class="message-form">
                                <input type="text"
                                       id="realtimeMessageInput"
                                       class="message-input"
                                       placeholder="Nhập tin nhắn..."
                                       disabled />

                                <button type="submit"
                                        id="realtimeSendBtn"
                                        class="send-btn"
                                        disabled>
                                    📤
                                </button>
                            </form>
                        </div>

                    </div>

                </div>

            </div>
        </div>

        @* <!-- 💬 TAB 8: CHAT VỚI NGƯỜI DÙNG -->
        <div id="user-admin-chat" class="tab">
            <div class="card">
                <h2>💬 Chat với mọi người</h2>
                <p class="subtitle">Gửi tin nhắn cho bất kỳ người dùng nào</p>

                <div class="user-admin-chat-container">
                    <!-- Users List Sidebar -->
                    <aside class="chat-admins-sidebar">
                        <div class="sidebar-search">
                            <input type="text" id="userChatSearch" placeholder="🔍 Tìm người..." class="search-input" />
                        </div>
                        <div id="userChatAdminsList" class="admins-list">
                            <div class="loading">⏳ Đang tải...</div>
                        </div>
                    </aside>

                    <!-- Chat Area -->
                    <div class="user-chat-area">
                        <!-- Header -->
                        <div class="user-chat-header">
                            <div class="chat-info">
                                <img id="chatWithAdminAvatar" src="https://via.placeholder.com/44" alt="Avatar" class="chat-avatar" />
                                <div class="chat-details">
                                    <h4 id="chatWithAdminName">Chọn người để chat</h4>
                                    <small id="chatWithAdminStatus">Offline</small>
                                </div>
                            </div>
                        </div>

                        <!-- Messages -->
                        <div id="userChatMessages" class="user-messages-area">
                            <div class="empty-chat-state">
                                <p>💬 Chọn người để bắt đầu trò chuyện</p>
                            </div>
                        </div>

                        <!-- Input -->
                        <div class="user-chat-input">
                            <form id="userChatForm" class="input-form">
                                <input type="text" id="userMessageInput" placeholder="Nhập tin nhắn..." class="message-input" disabled />
                                <button type="submit" id="userSendBtn" class="send-button" disabled>📤</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div> *@
    </div>
</section>

@section Scripts {
    <script src="~/js/main.js"></script>
    <script src="~/js/realtime-chat.js"></script>
    <script src="~/js/user-admin-chat.js"></script>
}

